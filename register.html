<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SnipBin – Daftar</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  :root{--accent:#6d28d9;--bg1:#eef2ff;--bg2:#f7f9ff}
  *{box-sizing:border-box}
  body{
    font-family:Inter,system-ui,Arial,sans-serif;
    background:linear-gradient(180deg,var(--bg1),var(--bg2));
    margin:0;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px;
  }
  .wrap{width:100%;max-width:420px}
  .card{background:#fff;border-radius:14px;padding:28px;border:1px solid rgba(110,76,246,0.06);box-shadow:0 12px 30px rgba(13,18,35,0.08)}
  .brand{text-align:center;margin-bottom:16px}
  .logo{width:52px;height:52px;margin:0 auto 10px;border-radius:12px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
  .logo img{width:100%;height:100%;object-fit:contain;display:block}
  .logo-fallback{position:absolute;inset:0;display:none;align-items:center;justify-content:center;font-weight:700;color:var(--accent);background:transparent}
  h2{margin:0;color:var(--accent);font-size:1.35rem}
  p.lead{margin:8px 0 18px;color:#555;font-size:14px}

  .input-group{position:relative;margin-bottom:14px}
  input{
    width:100%;padding:12px 44px 12px 12px;border-radius:10px;border:1px solid #e5e7eb;font-size:15px;outline:none;background:#fff;transition:border-color .12s, box-shadow .12s;line-height:1.2;
  }
  input.with-eye{padding-right:52px}
  input:focus{box-shadow:0 0 0 4px rgba(109,40,217,0.12);border-color:var(--accent)}

  .toggle-password{position:absolute;right:8px;top:50%;transform:translateY(-50%);height:36px;width:36px;border-radius:8px;border:0;background:transparent;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;color:#6b7280}
  .toggle-password:active{transform:translateY(-50%) scale(.97)}
  .toggle-password svg{display:block;pointer-events:none;transform:translateY(2px)}

  .primary{width:100%;padding:12px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-weight:700;cursor:pointer;font-size:15px;transition:transform .08s ease, box-shadow .08s ease}
  .primary:active{transform:translateY(1px)}
  .primary[disabled]{opacity:.6;cursor:not-allowed}

  .muted{font-size:13px;color:#6b7280;text-align:center;margin-top:12px}
  a.link{color:var(--accent);font-weight:600;text-decoration:none}

  #authMsg{margin-top:12px;text-align:center;font-weight:700;color:#dc2626;min-height:20px}
  #authMsg.success{color:#16a34a}

  footer{margin-top:18px;font-size:12px;color:#6b7280;text-align:center}
  @media (max-width:420px){.card{padding:20px}}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="form" aria-labelledby="register-heading">
      <div class="brand">
        <div class="logo">
          <img src="https://pomf2.lain.la/f/w53ncnd.png" alt="SnipBin logo" onerror="this.style.display='none'; this.parentElement.querySelector('.logo-fallback').style.display='flex'" />
          <span class="logo-fallback" aria-hidden="true">SB</span>
        </div>
        <h2 id="register-heading">SnipBin – Daftar</h2>
        <p class="lead">Buat akun baru. Aman, cepat, ringan.</p>
      </div>

      <div class="input-group">
        <label for="name" class="sr-only">Nama</label>
        <input id="name" type="text" placeholder="Nama lengkap" autocomplete="name" />
      </div>

      <div class="input-group">
        <label for="email" class="sr-only">Email</label>
        <input id="email" type="email" placeholder="contoh@gmail.com" autocomplete="email" inputmode="email" />
      </div>

      <div class="input-group">
        <label for="password" class="sr-only">Password</label>
        <input id="password" class="with-eye" type="password" placeholder="Masukkan password" autocomplete="new-password" />
        <button id="togglePassword" class="toggle-password" aria-pressed="false" aria-label="Tampilkan password" type="button">
          <svg id="eyeIcon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s4-7 10-7 10 7 10 7-4 7-10 7S2 12 2 12z"></path><circle cx="12" cy="12" r="3"></circle></svg>
        </button>
      </div>

      <button id="btnRegister" class="primary" type="button">Daftar</button>

      <p id="authMsg" aria-live="polite"></p>

      <div class="muted">Sudah punya akun? <a class="link" href="index.html">Login</a></div>
    </div>

    <footer>© 2025 by Renz. All rights reserved.</footer>
  </div>

<script>
/*
  IMPORTANT:
  - This client-side form now sends the registration request to a server endpoint (/api/create-user).
  - The server must use Supabase "service_role" key and call `supabase.auth.admin.createUser()` so the user is created without a confirmation email.
  - Never put your service_role key in client-side code. Keep it on the server (env var).

  Example server implementation (Node / Express) is provided separately.
*/

document.addEventListener('DOMContentLoaded', () => {
  const nameInput = document.getElementById('name');
  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const btn = document.getElementById('btnRegister');
  const togglePassword = document.getElementById('togglePassword');
  const authMsg = document.getElementById('authMsg');

  // toast element
  const toast = document.createElement('div');
  toast.id = 'globalToast';
  toast.setAttribute('role', 'status');
  toast.setAttribute('aria-live', 'polite');
  Object.assign(toast.style, {
    position: 'fixed', top: '18px', left: '50%', transform: 'translateX(-50%) translateY(-10px)',
    padding: '12px 16px', borderRadius: '10px', boxShadow: '0 8px 30px rgba(13,18,35,0.12)',
    background: '#111827', color: '#fff', fontWeight: '700', zIndex: 9999, opacity: '0', pointerEvents: 'none', transition: 'opacity 260ms ease, transform 260ms ease'
  });
  document.body.appendChild(toast);

  let toastTimer = null;
  function showToast(message = '', isError = true, duration = 3000){
    if(toastTimer) { clearTimeout(toastTimer); toastTimer = null; }
    toast.textContent = message;
    toast.style.background = isError ? '#111827' : '#059669';
    toast.style.opacity = '1';
    toast.style.pointerEvents = 'auto';
    toast.style.transform = 'translateX(-50%) translateY(0)';
    toastTimer = setTimeout(()=>{ toast.style.opacity = '0'; toast.style.transform = 'translateX(-50%) translateY(-10px)'; toastTimer = null; }, duration);
  }
  function clearToast(){ if(toastTimer) { clearTimeout(toastTimer); toastTimer = null; } toast.style.opacity = '0'; toast.style.transform = 'translateX(-50%) translateY(-10px)'; }

  function setLoading(on = true){ btn.disabled = on; btn.style.opacity = on ? 0.7 : 1; btn.textContent = on ? 'Memproses...' : 'Daftar'; }

  async function register(){
    clearToast(); authMsg.textContent = '';
    const name = nameInput.value.trim();
    const email = emailInput.value.trim();
    const password = passwordInput.value;

    if(!name){ showToast('Nama wajib diisi!', true); nameInput.focus(); return; }
    if(!email){ showToast('Email wajib diisi!', true); emailInput.focus(); return; }
    if(!password){ showToast('Password wajib diisi!', true); passwordInput.focus(); return; }
    if(password.length < 6){ showToast('Password minimal 6 karakter!', true); passwordInput.focus(); return; }

    setLoading(true);

    try{
      // send to server endpoint that creates user using Supabase admin API
      const res = await fetch('/api/create-user', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, email, password })
      });
      const payload = await res.json();
      if(!res.ok){
        const errMsg = payload?.error || payload?.message || 'Pendaftaran gagal';
        showToast(errMsg, true);
        setLoading(false);
        return;
      }

      // success
      showToast('Pendaftaran berhasil...', false);
      setTimeout(()=> window.location.href = 'app.html', 800);
    }catch(e){
      console.error(e);
      showToast('Terjadi kesalahan. Coba lagi.', true);
      setLoading(false);
    }
  }

  // toggle eye
  const svgEye = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s4-7 10-7 10 7 10 7-4 7-10 7S2 12 2 12z"></path><circle cx="12" cy="12" r="3"></circle></svg>';
  const svgEyeOff = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0112 19c-4.97 0-9-3.58-10-7a13.89 13.89 0 012.4-4.02M9.88 9.88A3 3 0 0115 12"/><path d="M3 3l18 18"/></svg>';
  let visible = false;
  function setEye(v){ visible = v; passwordInput.type = visible ? 'text' : 'password'; togglePassword.setAttribute('aria-pressed', String(visible)); togglePassword.setAttribute('aria-label', visible ? 'Sembunyikan password' : 'Tampilkan password'); togglePassword.innerHTML = visible ? svgEyeOff : svgEye; if(visible) passwordInput.focus(); }
  setEye(false);
  togglePassword.addEventListener('click', ()=> setEye(!visible));

  // events
  btn.addEventListener('click', register);
  document.addEventListener('keydown', (e) => {
    if(e.key === 'Enter' && (document.activeElement === nameInput || document.activeElement === emailInput || document.activeElement === passwordInput)){
      register();
    }
  });
});
</script>
</body>
</html>
