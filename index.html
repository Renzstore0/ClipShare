<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SnipBin – Login</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  /* Warna tema (sama seperti register) */
  :root{
    --accent:#6d28d9;
    --bg1:#eef2ff;
    --bg2:#f7f9ff;
    --text:#111827;
    --card:#fff;
    --muted:#6b7280;
    --label:#374151;
  }
  [data-theme="dark"]{
    --accent:#a78bfa;
    --bg1:#0f172a;
    --bg2:#1e293b;
    --text:#f9fafb;
    --card:#1e293b;
    --muted:#9ca3af;
    --label:#d1d5db;
  }

  *{box-sizing:border-box}
  html,body,*{ -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
  input, textarea, select { -webkit-user-select: text; user-select: text; }

  body{
    font-family:Inter,system-ui,Arial,sans-serif;
    background:linear-gradient(180deg,var(--bg1),var(--bg2));
    color:var(--text);
    margin:0;
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:100vh;
    padding:20px;
    position:relative;
  }

  #themeToggle{position:fixed;top:14px;right:14px;background:transparent;border:0;padding:8px;border-radius:10px;cursor:pointer;color:var(--text);z-index:999}
  #themeToggle svg{width:20px;height:20px;display:block}

  .wrap{width:100%;max-width:420px}
  .card{background:var(--card);border-radius:14px;padding:28px;border:1px solid rgba(110,76,246,0.06);box-shadow:0 12px 30px rgba(13,18,35,0.08)}
  .brand{text-align:center;margin-bottom:16px}
  .logo{width:52px;height:52px;margin:0 auto 10px;border-radius:12px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;pointer-events:none}
  .logo img{width:100%;height:100%;object-fit:contain;display:block;pointer-events:none;user-select:none}
  .logo-fallback{position:absolute;inset:0;display:none;align-items:center;justify-content:center;font-weight:700;color:var(--accent);background:transparent}
  h2{margin:0;color:var(--accent);font-size:1.35rem;user-select:none}
  p.lead{margin:8px 0 18px;color:var(--text);font-size:14px;user-select:none}

  .input-group{position:relative;margin-bottom:18px}
  label{display:block;font-size:14px;color:var(--label);font-weight:600;margin-bottom:6px}
  [data-theme="dark"] label{color:rgba(249,250,251,0.9)}

  input{
    width:100%;
    padding:12px 44px 12px 12px;
    border-radius:10px;
    border:1px solid #e5e7eb;
    font-size:15px;
    outline:none;
    background:#fff;
    transition:border-color .12s, box-shadow .12s;
    line-height:1.2;
    position:relative;
    color:var(--text);
  }
  input::placeholder{ color:#9ca3af; }
  [data-theme="dark"] input{ background: #0f1724; border-color: rgba(255,255,255,0.06); }
  [data-theme="dark"] input::placeholder{ color: rgba(249,250,251,0.5); }

  input.with-eye{padding-right:52px}
  input:focus{box-shadow:0 0 0 4px rgba(109,40,217,0.12);border-color:var(--accent)}

  .toggle-password{
    position:absolute;
    right:8px;
    top:50%;
    transform:translateY(-50%);
    height:28px;
    width:28px;
    border-radius:8px;
    border:0;
    background:transparent;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    color:#6b7280;
    z-index:30;
    padding:0;
  }
  .toggle-password svg{width:20px;height:20px;display:block;pointer-events:none}
  .toggle-password:active{transform:translateY(-50%) scale(.98)}
  .toggle-password:focus{outline: 3px solid rgba(109,40,217,0.12); outline-offset: 2px; border-radius:8px;}

  .primary{width:100%;padding:12px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-weight:700;cursor:pointer;font-size:15px;transition:transform .08s ease, box-shadow .08s ease}
  .primary:active{transform:translateY(1px)}
  .primary[disabled]{opacity:.6;cursor:not-allowed}

  .muted{font-size:13px;color:var(--muted);text-align:center;margin-top:12px;user-select:none}
  a.link{color:var(--accent);font-weight:600;text-decoration:none}

  #authMsg{margin-top:12px;text-align:center;font-weight:700;color:#dc2626;min-height:20px}
  #authMsg.success{color:#16a34a}

  footer{margin-top:18px;font-size:12px;color:var(--muted);text-align:center;user-select:none}

  /* toast kecil (sama seperti register) */
  .toast-hidden{opacity:0;transform:translateY(-10px);pointer-events:none}

  @media (max-width:420px){
    .card{padding:20px}
    input.with-eye{padding-right:56px}
    .toggle-password{right:8px;height:28px;width:28px;padding:0}
    .toggle-password svg{width:20px;height:20px}
  }
</style>
</head>
<body>
  <button id="themeToggle" aria-label="Toggle theme" title="Toggle theme">
    <svg id="themeIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.66-12.34l-.7.7M5.34 18.66l-.7.7M21 12h1M2 12H1m16.66 6.66l-.7-.7M5.34 5.34l-.7-.7M12 5a7 7 0 100 14a7 7 0 000-14z"/></svg>
  </button>

  <div class="wrap">
    <div class="card" role="form" aria-labelledby="login-heading">
      <div class="brand">
        <div class="logo">
          <img src="https://pomf2.lain.la/f/w53ncnd.png" alt="SnipBin logo" onerror="this.style.display='none'; this.parentElement.querySelector('.logo-fallback').style.display='flex'" />
          <span class="logo-fallback" aria-hidden="true">SB</span>
        </div>
        <h2 id="login-heading">SnipBin – Login</h2>
        <p class="lead">Masuk untuk mengelola potongan teks Anda. Aman, cepat, ringan.</p>
      </div>

      <div class="input-group">
        <label for="identifier">Nama atau Email</label>
        <input id="identifier" type="text" placeholder="Masukkan nama atau email" autocomplete="username" inputmode="email" />
      </div>

      <div class="input-group">
        <label for="password">Password</label>
        <input id="password" class="with-eye" type="password" placeholder="Masukkan password" autocomplete="current-password" />
        <button id="togglePassword" class="toggle-password" aria-pressed="false" aria-label="Tampilkan password" type="button">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s4-7 10-7 10 7 10 7-4 7-10 7S2 12 2 12z"></path><circle cx="12" cy="12" r="3"></circle></svg>
        </button>
      </div>

      <button id="btnLogin" class="primary" type="button">Login</button>
      <p id="authMsg" aria-live="polite"></p>
      <div class="muted">Belum punya akun? <a class="link" href="register.html">Daftar</a></div>
    </div>

    <footer>© 2025 by Renz. All rights reserved.</footer>
  </div>

<script>
/* -------------------------
   Supabase config
   ------------------------- */
const supabaseUrl = "https://ovocnshoodsjytoeahpy.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92b2Nuc2hvb2Rzanl0b2VhaHB5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgxOTM2NDEsImV4cCI6MjA3Mzc2OTY0MX0.r-uug7AzRu5LmMWSU5zGquUbxydgiBk6qtbu5VfBOlg";
const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

/* -------------------------
   Element refs
   ------------------------- */
const identifierInput = document.getElementById('identifier');
const passwordInput = document.getElementById('password');
const togglePassword = document.getElementById('togglePassword');
const btnLogin = document.getElementById('btnLogin');
const authMsg = document.getElementById('authMsg');
const themeToggle = document.getElementById('themeToggle');
const themeIcon = document.getElementById('themeIcon');

/* -------------------------
   Theme persistence (sama seperti register)
   ------------------------- */
function applyTheme(theme){
  document.documentElement.setAttribute('data-theme', theme);
  localStorage.setItem('theme', theme);
  themeIcon.innerHTML = theme === 'dark'
    ? '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z\"/>'
    : '<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 3v1m0 16v1m8.66-12.34l-.7.7M5.34 18.66l-.7.7M21 12h1M2 12H1m16.66 6.66l-.7-.7M5.34 5.34l-.7-.7M12 5a7 7 0 100 14a7 7 0 000-14z\"/>';
}
const savedTheme = localStorage.getItem('theme') || 'light';
applyTheme(savedTheme);
themeToggle.addEventListener('click', ()=>{
  const current = document.documentElement.getAttribute('data-theme');
  applyTheme(current === 'dark' ? 'light' : 'dark');
});

/* -------------------------
   Eye toggle (ikon di dalam input)
   ------------------------- */
const svgEye = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s4-7 10-7 10 7 10 7-4 7-10 7S2 12 2 12z"></path><circle cx="12" cy="12" r="3"></circle></svg>';
const svgEyeOff = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0112 19c-4.97 0-9-3.58-10-7a13.89 13.89 0 012.4-4.02M9.88 9.88A3 3 0 0115 12"/><path d="M3 3l18 18"/></svg>';

let visible = false;
function setEye(v){
  visible = v;
  passwordInput.type = visible ? 'text' : 'password';
  togglePassword.setAttribute('aria-pressed', String(visible));
  togglePassword.setAttribute('aria-label', visible ? 'Sembunyikan password' : 'Tampilkan password');
  togglePassword.innerHTML = visible ? svgEyeOff : svgEye;
}
setEye(false);
togglePassword.addEventListener('click', ()=> setEye(!visible));

/* -------------------------
   Toast helper (simple)
   ------------------------- */
const toast = document.createElement('div');
Object.assign(toast.style, {
  position:'fixed',
  top:'18px',
  left:'50%',
  transform:'translateX(-50%) translateY(-10px)',
  padding:'12px 16px',
  borderRadius:'10px',
  boxShadow:'0 8px 30px rgba(13,18,35,0.12)',
  background:'#111827',
  color:'#fff',
  fontWeight:'700',
  zIndex:9999,
  opacity:0,
  transition:'opacity 220ms, transform 220ms'
});
document.body.appendChild(toast);
let toastTimer = null;
function showToast(msg, isError = true, duration = 3000){
  if(toastTimer) clearTimeout(toastTimer);
  toast.textContent = msg;
  toast.style.background = isError ? '#111827' : '#059669';
  toast.style.opacity = '1';
  toast.style.transform = 'translateX(-50%) translateY(0)';
  toastTimer = setTimeout(()=>{ toast.style.opacity = '0'; toast.style.transform = 'translateX(-50%) translateY(-10px)'; toastTimer = null; }, duration);
}

/* -------------------------
   Login handler
   ------------------------- */
function setAuthMsg(text, ok = false){
  authMsg.textContent = text;
  authMsg.className = ok ? 'success' : '';
}

async function login(){
  setAuthMsg('');
  const identifier = identifierInput.value.trim();
  const password = passwordInput.value;
  if(!identifier){ showToast('Nama atau Email wajib diisi', true); identifierInput.focus(); return; }
  if(!password){ showToast('Password wajib diisi', true); passwordInput.focus(); return; }

  btnLogin.disabled = true;
  const prevText = btnLogin.textContent;
  btnLogin.textContent = 'Memproses...';

  try{
    // menggunakan email sebagai identifier ke supabase auth
    const { data, error } = await supabaseClient.auth.signInWithPassword({ email: identifier, password });
    if(error){
      showToast(error.message || 'Login gagal', true);
      setAuthMsg(error.message || 'Login gagal');
      btnLogin.disabled = false;
      btnLogin.textContent = prevText;
      return;
    }
    showToast('Login berhasil', false);
    setAuthMsg('Login berhasil', true);
    // arahkan ke app.html setelah sebentar (mirip register)
    setTimeout(()=> window.location.href = 'app.html', 700);
  }catch(e){
    console.error(e);
    showToast('Terjadi kesalahan', true);
    setAuthMsg('Terjadi kesalahan. Coba lagi.');
    btnLogin.disabled = false;
    btnLogin.textContent = prevText;
  }
}

/* Enter key support */
[identifierInput, passwordInput].forEach(inp => {
  inp.addEventListener('keydown', (e) => { if(e.key === 'Enter') login(); });
});

/* hook button */
btnLogin.addEventListener('click', login);
</script>
</body>
</html>
